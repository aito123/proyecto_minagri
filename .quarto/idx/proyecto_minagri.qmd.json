{"title":"Reporte MIDAGRI","markdown":{"yaml":{"title":"Reporte MIDAGRI","author":"Santiago Sotelo","date":"today","date-format":"long","format":"html","execute":{"echo":false,"message":false,"warning":false},"df-print":"kable","lang":"es"},"headingText":"| output: false","containsRefs":false,"markdown":"\n\n```{=html}\n<style type=\"text/css\">\ncaption, .table-caption {\n  text-align: left;\n}\n</style>\n```\n\n**Objetivo**: Se realizará una exploración de la base de datos del MIDAGRI. Luego se exportará la base de datos que solo incluya los sembríos de espárrago, palto, maíz, caña de azúcar y papa.\n\n```{r}\n\npacman::p_load(haven, tidyverse, janitor, sf, here, gt, kableExtra)\nhere::i_am(\"proyecto_minagri.qmd\")\noptions(width = 300)\n\n```\n\n## Importar data\n\nLayers disponibles en la carpeta `QLAB_MIDAGRI_1.gdb`:\n\n```{r}\n#| column: screen-right\n\nsf::st_layers(here::here(\"data/QLAB_MIDAGRI_1.gdb\")) \n  \n\n```\n\n## Plot Layers\n\n```{r}\n#| label: importar layers por separado\n#| warning: false\n\nparcelasmi<-sf::st_read(here::here(\"data/QLAB_MIDAGRI_1.gdb\"), layer = \"ParcelaSMI\", quiet=TRUE) \nparcelasm<-sf::st_read(here::here(\"data/QLAB_MIDAGRI_1.gdb\"), layer = \"ParcelaSM\", quiet=TRUE)\nlotesm<-sf::st_read(here::here(\"data/QLAB_MIDAGRI_1.gdb\"), layer = \"LoteSM\", quiet=TRUE)\ncentropoblado<-sf::st_read(here::here(\"data/QLAB_MIDAGRI_1.gdb\"), layer = \"CentroPoblado\", quiet=TRUE)\ncobertura_a<-sf::st_read(here::here(\"data/QLAB_MIDAGRI_1.gdb\"), layer = \"CoberturaA\", quiet=TRUE)\ndistritos<-sf::st_read(here::here(\"data/QLAB_MIDAGRI_1.gdb\"), layer = \"Distritos\", quiet=TRUE)\npisos_a<-sf::st_read(here::here(\"data/QLAB_MIDAGRI_1.gdb\"), layer = \"PisosA\", quiet=TRUE)\nhidrografia<-sf::st_read(here::here(\"data/QLAB_MIDAGRI_1.gdb\"), layer = \"Hidrografia\", quiet=TRUE)\nvias<-sf::st_read(here::here(\"data/QLAB_MIDAGRI_1.gdb\"), layer = \"Vias\", quiet=TRUE)\nsectoresmma<-sf::st_read(here::here(\"data/QLAB_MIDAGRI_1.gdb\"), layer = \"SectorEsMMA\", quiet=TRUE)\nprovincias<-sf::st_read(here::here(\"data/QLAB_MIDAGRI_1.gdb\"), layer = \"Provincias\", quiet=TRUE)\nregiones<-sf::st_read(here::here(\"data/QLAB_MIDAGRI_1.gdb\"), layer = \"Regiones\", quiet=TRUE)\nsede_a<-sf::st_read(here::here(\"data/QLAB_MIDAGRI_1.gdb\"), layer = \"SedeA\", quiet=TRUE)\nmarcoarea<-sf::st_read(here::here(\"data/QLAB_MIDAGRI_1.gdb\"), layer = \"MARCOAREA_LA_LIBERTAD_ac\", quiet=TRUE)\nmarcolistaempresa<-sf::st_read(here::here(\"data/QLAB_MIDAGRI_1.gdb\"), layer = \"MARCOLISTAEMPRESA_LA_LIBERTAD_ac\", quiet=TRUE)\nmarcolistaencuesta<-sf::st_read(here::here(\"data/QLAB_MIDAGRI_1.gdb\"), layer = \"MARCOLISTAENCUESTA_LA_LIBERTAD\", quiet=TRUE)\nmarcolistauso<-sf::st_read(here::here(\"data/QLAB_MIDAGRI_1.gdb\"), layer = \"MARCOLISTAUSO_LA_LIBERTAD\", quiet=TRUE)\n\n```\n\n```{r}\n#| label: fig-plot\n#| layout-ncol: 5\n#| column: body-outset\n#| fig-cap: Ploteo de layers de `QLAB_MIDAGRI_1.gdb`\n#| fig-subcap: \n#| - ParcelaSMI\n#| - ParcelaSM\n#| - LoteSM\n#| - CentroPoblado\n#| - CoberturaA\n#| - Distritos\n#| - PisosA\n#| - Hidrografia\n#| - Vias\n#| - SectorEsMMA\n#| - Provincias\n#| - Regiones\n#| - SedeA\n#| - MARCOAREA...\n#| - MARCOLISTAEMP...\n#| - MARCOLISTAENC...\n#| - MARCOLISTAUSO...\n\nparcelasmi %>% ggplot() + geom_sf() + theme_void()\nparcelasm %>% ggplot() + geom_sf() + theme_void()\nlotesm %>% ggplot() + geom_sf() + theme_void()\ncentropoblado %>% ggplot() + geom_sf() + theme_void()\ncobertura_a %>% ggplot() + geom_sf() + theme_void()\ndistritos %>% ggplot() + geom_sf() + theme_void()\npisos_a %>% ggplot() + geom_sf() + theme_void()\nhidrografia %>% ggplot() + geom_sf() + theme_void()\nvias %>% ggplot() + geom_sf() + theme_void()\nsectoresmma %>% ggplot() + geom_sf() + theme_void()\nprovincias %>% ggplot() + geom_sf() + theme_void()\nregiones %>% ggplot() + geom_sf() + theme_void()\nsede_a %>% ggplot() + geom_sf() + theme_void()\nmarcoarea %>% ggplot() + geom_sf() + theme_void()\nmarcolistaempresa %>% ggplot() + geom_sf() + theme_void()\nmarcolistaencuesta %>% ggplot() + geom_sf() + theme_void()\nmarcolistauso %>% ggplot() + geom_sf() + theme_void()\n\n```\n\n## Cálculo de área por cultivo.\n\nPara realizar este cálculo necesitamos el layer `LoteSM`:\n\n```{r}\n#| label: tbl-filas\n#| tbl-cap: Primeras 5 filas del layer `LoteSM`\n\nlotesm %>% \n  head(5) %>% \n  knitr::kable()\n  \n```\n\nEn particular las variables:\n\n- `NOMPROV`: Nombre de la provincia\n- `USO_LOTE`: Tipo de uso y cobertura de la tierra (papa, palta, pastos cultivados y otros usos que no sean cultivos (infraestructuras, cuerpos de agua, eriazos, formaciones rocosas etc…), P_301a. 100 Opciones. Selección única.\n- `AREA_LOTE`: Área del Lote en hectáreas (Calcular en Zona 18).\n\n:::{.callout-tip collapse=true appearance='default' icon=true}\n## Tipos de uso del lote como se definen en el `DICCIONARIO_MMM_18_11_2021.xlsx`\n\n| Variable     | Categorías                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |\n|--------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n| CULTIVO_LOTE | 1.  kiwicha, o   amaranto<br>     2. Aji<br>     3. Ajo<br>     4. Alcachofa<br>     5. Alfalfa<br>     6. Algodon<br>     7. Arandanos<br>     8. Arroz<br>     9. Arverja<br>     10. Avena<br>     11. Banano<br>     12. Cacao<br>     13. Cafe<br>     14. Camerun<br>     15. Camote<br>     16. Capuli<br>     17. Cebada  <br>     18. Cebolla<br>     19. Cerezo<br>     20. Chia (Salvia Hispanica)<br>     21. Chiromoya<br>     22. Chocho o Tarwi<br>     23. Ciruelo<br>     24. Col o repollo <br>     25. Culantro <br>     26. Esparrago<br>     27. Frijol<br>     28. Garbanzo<br>     29. Granadilla<br>     30. Granado<br>     31. Guanabano<br>     32. Guayabo<br>     33. Haba<br>     34. Higuera<br>     35. Lechuga<br>     36. Lenteja<br>     37. Lima<br>     38. Limon<br>     39. Linaza<br>     40. Lucuma<br>     41. Maíz<br>     42. Mamey<br>     43. Mandarina<br>     44. Mango<br>     45. Mani<br>     46. Manzano<br>     47. Maracuya<br>     48. Marigold<br>     49. Mashua o izano<br>     50. Melocotonero<br>     51. Melon <br>     52. Membrillo<br>     53. Naranjo<br>     54. Ñuña<br>     55. Oca<br>     56. Olivo<br>     57. Olluco<br>     58. Pacae o guabo<br>     59. Pallar <br>     60. Palto<br>     61. Papa<br>     62. Papikra<br>     63. Otros Pastos Cultivados<br>     64. Pecano<br>     65. Pepinillo<br>     66. Pepino<br>     67. Pimiento<br>     68. Piña<br>     69. Piquillo<br>     70. Pitahaya<br>     71. Platano<br>     72. Quinua<br>     73. Rabano<br>     74. Sandia<br>     75. Sorgo<br>     76. Tara<br>     77. Tomate<br>     78. Trigo<br>     79. Tumbo<br>     80. Tuna <br>     81. Vid<br>     82. Yuca<br>     83. Zanahoria<br>     84. Zapallo<br>     85. Zarandaja<br>     86. Caña de azucar<br>     87. Cuerpos de agua<br>     88. Cultivos Ilícitos<br>     89. Eriazos<br>     90. Infraestructura Agrícola<br>     91. Inraestructura Pecuaria<br>     92. Montes y Bosques<br>     93. Otros Cultivos Permanentes<br>     94. Otros Cultivos Transitorios<br>     95. Otros Usos de la Tierra<br>     96. Plantaciones Forestales<br>     97. Tierras con Pastos Naturales<br>     98. Tierras en Barbecho.<br>     99. Tierras en descanso<br>     100. Vergel<br>      |\n\n:::\n\nTabulación cruzada por sembrío:\n\n```{r}\nlotesm_1<-\n  lotesm %>% \n  mutate(\n   uso_lote1=case_when(\n     USO_LOTE == 1 ~ 'kiwicha, o amaranto',\n     USO_LOTE == 2 ~ 'Aji',\n     USO_LOTE == 3 ~ 'Ajo',\n     USO_LOTE == 4 ~ 'Alcachofa',\n     USO_LOTE == 5 ~ 'Alfalfa',\n     USO_LOTE == 6 ~ 'Algodon',\n     USO_LOTE == 7 ~ 'Arandanos',\n     USO_LOTE == 8 ~ 'Arroz',\n     USO_LOTE == 9 ~ 'Arverja',\n     USO_LOTE == 10 ~ 'Avena',\n     USO_LOTE == 11 ~ 'Banano',\n     USO_LOTE == 12 ~ 'Cacao',\n     USO_LOTE == 13 ~ 'Cafe',\n     USO_LOTE == 14 ~ 'Camerun',\n     USO_LOTE == 15 ~ 'Camote',\n     USO_LOTE == 16 ~ 'Capuli',\n     USO_LOTE == 17 ~ 'Cebada',\n     USO_LOTE == 18 ~ 'Cebolla',\n     USO_LOTE == 19 ~ 'Cerezo',\n     USO_LOTE == 20 ~ 'Chia (Salvia Hispanica)',\n     USO_LOTE == 21 ~ 'Chiromoya',\n     USO_LOTE == 22 ~ 'Chocho o Tarwi',\n     USO_LOTE == 23 ~ 'Ciruelo',\n     USO_LOTE == 24 ~ 'Col o repollo',\n     USO_LOTE == 25 ~ 'Culantro',\n     USO_LOTE == 26 ~ 'Esparrago',\n     USO_LOTE == 27 ~ 'Frijol',\n     USO_LOTE == 28 ~ 'Garbanzo',\n     USO_LOTE == 29 ~ 'Granadilla',\n     USO_LOTE == 30 ~ 'Granado',\n     USO_LOTE == 31 ~ 'Guanabano',\n     USO_LOTE == 32 ~ 'Guayabo',\n     USO_LOTE == 33 ~ 'Haba',\n     USO_LOTE == 34 ~ 'Higuera',\n     USO_LOTE == 35 ~ 'Lechuga',\n     USO_LOTE == 36 ~ 'Lenteja',\n     USO_LOTE == 37 ~ 'Lima',\n     USO_LOTE == 38 ~ 'Limon',\n     USO_LOTE == 39 ~ 'Linaza',\n     USO_LOTE == 40 ~ 'Lucuma',\n     USO_LOTE == 41 ~ 'Maíz',\n     USO_LOTE == 42 ~ 'Mamey',\n     USO_LOTE == 43 ~ 'Mandarina',\n     USO_LOTE == 44 ~ 'Mango',\n     USO_LOTE == 45 ~ 'Mani',\n     USO_LOTE == 46 ~ 'Manzano',\n     USO_LOTE == 47 ~ 'Maracuya',\n     USO_LOTE == 48 ~ 'Marigold',\n     USO_LOTE == 49 ~ 'Mashua o izano',\n     USO_LOTE == 50 ~ 'Melocotonero',\n     USO_LOTE == 51 ~ 'Melon',\n     USO_LOTE == 52 ~ 'Membrillo',\n     USO_LOTE == 53 ~ 'Naranjo',\n     USO_LOTE == 54 ~ 'Ñuña',\n     USO_LOTE == 55 ~ 'Oca',\n     USO_LOTE == 56 ~ 'Olivo',\n     USO_LOTE == 57 ~ 'Olluco',\n     USO_LOTE == 58 ~ 'Pacae o guabo',\n     USO_LOTE == 59 ~ 'Pallar',\n     USO_LOTE == 60 ~ 'Palto',\n     USO_LOTE == 61 ~ 'Papa',\n     USO_LOTE == 62 ~ 'Papikra',\n     USO_LOTE == 63 ~ 'Otros Pastos Cultivados',\n     USO_LOTE == 64 ~ 'Pecano',\n     USO_LOTE == 65 ~ 'Pepinillo',\n     USO_LOTE == 66 ~ 'Pepino',\n     USO_LOTE == 67 ~ 'Pimiento',\n     USO_LOTE == 68 ~ 'Piña',\n     USO_LOTE == 69 ~ 'Piquillo',\n     USO_LOTE == 70 ~ 'Pitahaya',\n     USO_LOTE == 71 ~ 'Platano',\n     USO_LOTE == 72 ~ 'Quinua',\n     USO_LOTE == 73 ~ 'Rabano',\n     USO_LOTE == 74 ~ 'Sandia',\n     USO_LOTE == 75 ~ 'Sorgo',\n     USO_LOTE == 76 ~ 'Tara',\n     USO_LOTE == 77 ~ 'Tomate',\n     USO_LOTE == 78 ~ 'Trigo',\n     USO_LOTE == 79 ~ 'Tumbo',\n     USO_LOTE == 80 ~ 'Tuna',\n     USO_LOTE == 81 ~ 'Vid',\n     USO_LOTE == 82 ~ 'Yuca',\n     USO_LOTE == 83 ~ 'Zanahoria',\n     USO_LOTE == 84 ~ 'Zapallo',\n     USO_LOTE == 85 ~ 'Zarandaja',\n     USO_LOTE == 86 ~ 'Caña de azucar',\n     USO_LOTE == 87 ~ 'Cuerpos de agua',\n     USO_LOTE == 88 ~ 'Cultivos Ilícitos',\n     USO_LOTE == 89 ~ 'Eriazos',\n     USO_LOTE == 90 ~ 'Infraestructura Agrícola',\n     USO_LOTE == 91 ~ 'Inraestructura Pecuaria',\n     USO_LOTE == 92 ~ 'Montes y Bosques',\n     USO_LOTE == 93 ~ 'Otros Cultivos Permanentes',\n     USO_LOTE == 94 ~ 'Otros Cultivos Transitorios',\n     USO_LOTE == 95 ~ 'Otros Usos de la Tierra',\n     USO_LOTE == 96 ~ 'Plantaciones Forestales',\n     USO_LOTE == 97 ~ 'Tierras con Pastos Naturales',\n     USO_LOTE == 98 ~ 'Tierras en Barbecho.',\n     USO_LOTE == 99 ~ 'Tierras en descanso',\n     USO_LOTE == 100 ~ 'Vergel', \n     TRUE~\"No asignado\"\n   ), .after = USO_LOTE\n  )\n```\n\n\n```{r}\n#| label: tbl-tabla1\n#| tbl-cap: Área total del lote por sembrío de La Libertad\n\nlotesm_1 %>% \n  as.data.frame() %>% \n  group_by(uso_lote1) %>% \n  summarise(`Área lote total (Ha)`= round_half_up(sum(AREA_LOTE), digits = 2)) %>% \n  arrange(desc(`Área lote total (Ha)`)) %>% \n  knitr::kable() %>% \n  scroll_box(height = \"300px\")\n\n```\n\n<br>\n\nTabulación cruzada por sembrío según provincia de La Libertad:\n\n```{r}\n#| label: tbl-tablafinal\n#| tbl-cap: Área total del lote por sembrío según provincia de La Libertad\n\nlotesm_1 %>% \n  as.data.frame() %>% \n  group_by(NOMBPROV, uso_lote1) %>% \n  summarise(`Área lote total (Ha)`= round_half_up(sum(AREA_LOTE), digits = 2)) %>% \n  arrange(NOMBPROV, desc(`Área lote total (Ha)`)) %>% \n  knitr::kable() %>% \n  scroll_box(height = \"300px\")\n  \n\n```\n\n## Extracción LoteSM\n\nSe solicita la extracción de las parcelas con los determinados productos:\n\n```{r}\n#| label: tbl-tabla2\n#| tbl-cap: Número de casos por tipo de sembrío de La Libertad\n\nlotesm_1 %>% \n  as.data.frame() %>% \n  group_by(uso_lote1) %>%\n  summarise(`Nro de casos en data`= n()) %>% \n  filter(uso_lote1 %in% c(\"Esparrago\", \"Palto\", \"Maíz\", \"Caña de azucar\", \"Papa\")) %>% \n  arrange(desc(`Nro de casos en data`)) %>% \n  janitor::adorn_totals() %>% \n  knitr::kable() %>% \n  kable_styling()%>%\n  row_spec(6,italic=T)\n\n```\n\n```{r}\n#| eval: false\n\nfs::dir_create(here(\"data\", \"lotesm_1\"))\nlotesm_1 %>% \n  filter(uso_lote1 %in% c(\"Esparrago\", \"Palto\", \"Maíz\", \"Caña de azucar\", \"Papa\")) %>%\n  st_write(here(\"data\", \"lotesm_1\", \"lotesm_1.shp\"), delete_layer = TRUE, quiet = TRUE) #overwrites\n\n```\n\n:::{.callout-note collapse=false appearance='default' icon=true}\n\n## Conclusión\n\nEl \"sembrío\" con mayor área de cultivo es tierras con pastos naturales, tierras eriazas, tierras en descanso, otros usos de la tierra, montos y bosques entre otros.\n\nRespecto a cultivos, se tiene a tara, espárragos, palto, maíz, caña de azúcar, arroz, pimiento, papa, entre otros.\n\n:::\n"},"formats":{"html":{"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"kable","error":false,"eval":true,"cache":null,"freeze":"auto","echo":false,"output":true,"warning":false,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"message":false,"engine":"knitr"},"render":{"keep-tex":false,"keep-yaml":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","toc":true,"output-file":"proyecto_minagri.html"},"language":{},"metadata":{"lang":"es","fig-responsive":true,"quarto-version":"1.0.36","theme":{"light":"Litera"},"title":"Reporte MIDAGRI","author":"Santiago Sotelo","date":"today","date-format":"long"},"extensions":{"book":{"multiFile":true}}}}}